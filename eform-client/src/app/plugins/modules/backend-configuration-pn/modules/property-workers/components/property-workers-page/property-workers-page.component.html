<eform-new-subheader>
  <button
    color="accent"
    mat-icon-button
    id="newDeviceUserBtn"
    *ngIf="userClaims.deviceUsersCreate"
    matTooltip="{{ 'Create new employee' | translate }}"
    (click)="openCreateModal()"
    [matTooltipPosition]="'left'"
  >
    <mat-icon>add</mat-icon>
  </button>
</eform-new-subheader>

<ng-template #toolbarTpl>
  <div class="d-flex flex-row justify-content-start flex-nowrap">
    <div class="d-flex flex-column mr-2 ml-2">
      <mat-form-field>
        <mat-label>{{ 'Search' | translate }}</mat-label>
        <input
          matInput
          type="text"
          (ngModelChange)="onSearchChanged($event)"
          [ngModel]="propertyWorkersStateService.getNameFilter() | async"
          id="labelInput"
        />
      </mat-form-field>
    </div>
  </div>
</ng-template>

<mtx-grid
  [data]="sitesDto"
  [columns]="tableHeaders"
  [cellTemplate]="{customerOtp: customerOtpTpl, property: propertyTpl}"
  [showPaginator]="false"
  [pageOnFront]="false"
  [rowStriped]="true"
  [showToolbar]="true"
  [showColumnMenuButton]="false"
  [toolbarTemplate]="toolbarTpl"
  [sortActive]="propertyWorkersStateService.getActiveSort() | async"
  [sortDirection]="propertyWorkersStateService.getActiveSortDirection() | async"
  (sortChange)="sortTable($event)">
</mtx-grid>

<ng-template #customerOtpTpl let-row>
  <ng-container *ngIf="row.customerNo && row.otpCode">
    {{ row.customerNo }} / {{ row.otpCode }}
  </ng-container>
  <ng-container *ngIf="row.otpCode == 0">
    <button
      mat-icon-button
      color="warn"
      *ngIf="userClaims.deviceUsersUpdate"
      matTooltip="{{ 'New OTP' | translate }}"
      (click)="openOtpModal(row)"
    >
      <mat-icon>key</mat-icon>
    </button>
  </ng-container>
  <ng-container *ngIf="!row.unitId"> N/A</ng-container>
</ng-template>

<ng-template #propertyTpl let-row>
  <div [innerHTML]="this.getWorkerPropertyNames(row.siteId)"></div>
</ng-template>
