<div
  [config]="{ ignoreBackdropClick: true }"
  mdbModal
  class="modal fade"
  #frame="mdbModal"
  style="overflow-y: scroll"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h3>{{ (isCreate ? 'Create new task' : 'View task') | translate }}</h3>
        </div>
        <button class="close" data-dismiss="modal" (click)="hide()">
          <span>×</span>
        </button>
      </div>
      <div class="modal-body">
        <div [formGroup]="workOrderCaseForm">
          <div class="d-flex flex-row ng-select-wrapper">
            <ng-select
              [placeholder]="'Property' | translate"
              [items]="properties"
              bindLabel="name"
              bindValue="id"
              formControlName="propertyId"
              id="propertyId"
              [clearable]="false"
              class="mr-2"
            >
            </ng-select>
            <ng-select
              [placeholder]="'Area' | translate"
              [items]="propertyAreas"
              formControlName="areaName"
              id="areaName"
              [clearable]="false"
              class="mr-2"
            >
            </ng-select>
            <ng-select
              [placeholder]="'Assigned to' | translate"
              bindLabel="name"
              bindValue="id"
              formControlName="assignedTo"
              id="assignedTo"
              [items]="assignedSitesToProperty"
              [clearable]="isCreate"
            >
            </ng-select>
          </div>
          <div class="d-flex flex-column mb-2">
            <div>
              <button
                *ngIf="isCreate"
                mdbBtn
                class="btn-success btn-icon m-1"
                id="addNewImages"
                mdbTooltip="{{ 'Add new image' | translate }}"
                (click)="frame.hide(); addNewImageModal.show()"
              >
                <fa-icon icon="plus" size="lg"></fa-icon>
              </button>
            </div>
            <div class="d-flex flex-row flex-wrap">
              <div
                class="m-1 mr-2 mb-2"
                *ngFor="let image of images; let i = index"
              >
                <mdb-card>
                  <button
                    *ngIf="isCreate"
                    class="close"
                    data-dismiss="modal"
                    style="right: 5px; color: red"
                    (click)="deleteImageByName(image.fileName)"
                    mdbTooltip="{{ 'Delete picture' | translate }}"
                  >
                    <span>×</span>
                  </button>
                  <mdb-card-img
                    (click)="openPicture(i)"
                    [src]="image.src | authImage | async"
                    alt="Card image cap"
                  >
                  </mdb-card-img>
                </mdb-card>
              </div>
            </div>
          </div>
          <formatting-text-editor
            id="descriptionTask"
            [placeholder]="'Description of task' | translate"
            [(value)]="description"
            [disabled]="!isCreate"
          >
          </formatting-text-editor>
        </div>
      </div>
      <div class="modal-footer">
        <button
          mdbBtn
          class="btn-success btn-small-height"
          id="taskManagementCreateShowSaveBtn"
          [disabled]="!(workOrderCaseForm.valid && isCreate)"
          (click)="create()"
        >
          {{ 'Save' | translate }}
        </button>
        <button
          mdbBtn
          class="btn-accent text-black-50 btn-small-height"
          (click)="hide()"
          id="taskManagementCreateShowSaveCancelBtn"
        >
          {{ 'Cancel' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<div mdbModal class="modal fade" #addNewImageModal="mdbModal">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ 'Select image' | translate }}</h3>
      </div>
      <div class="modal-body">
        <input
          type="file"
          hidden
          accept="image/*"
          (change)="onFileSelected($event)"
          id="imageInput"
          #fileUpload
        />
        <div>
          {{ newImage ? newImage.name : ('No file uploaded yet.' | translate) }}
          <button
            mdbBtn
            class="btn-primary btn-small-height"
            (click)="fileUpload.click()"
          >
            {{ 'Select image' | translate }}
          </button>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-around">
        <button
          mdbBtn
          class="btn-success btn-small-height"
          (click)="addPicture()"
          [disabled]="!newImage"
        >
          {{ 'Add' | translate }}
        </button>
        <button
          mdbBtn
          class="btn-accent text-black-50 btn-small-height"
          (click)="addNewImageModal.hide(); frame.show()"
        >
          {{ 'Cancel' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
